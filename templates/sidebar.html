<link rel="stylesheet" href="/static/styles/sidebar.css">

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  
	<script>
		let map, infoWindow;
  
		function initMap() {
		  map = new google.maps.Map(document.getElementById("map"), {
			center: { lat: -34.397, lng: 150.644 },
			zoom: 12,
		  });
		  infoWindow = new google.maps.InfoWindow();
  
		if (navigator.geolocation) {
			  navigator.geolocation.getCurrentPosition(
				(position) => {
				  const pos = {
					lat: position.coords.latitude,
					lng: position.coords.longitude,
				  };

          // call update_location function in app.py with pos as parameter
          $.ajax({
            type: "POST",
            url: "/update_location",
            data: JSON.stringify(pos),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(data){
              console.log(data);
            },
            failure: function(errMsg) {
              console.log(errMsg);
            }
          });
  
				  infoWindow.setPosition(pos);
				  infoWindow.setContent("Location found.");
				  infoWindow.open(map);
				  map.setCenter(pos);
				},
				() => {
				  handleLocationError(true, infoWindow, map.getCenter());
				}
			  );
			} else {
			  // Browser doesn't support Geolocation
			  handleLocationError(false, infoWindow, map.getCenter());
			}
		  };
  
		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
		  infoWindow.setPosition(pos);
		  infoWindow.setContent(
			browserHasGeolocation
			  ? "Error: The Geolocation service failed."
			  : "Error: Your browser doesn't support geolocation."
		  );
		  infoWindow.open(map);
		}
  
		window.initMap = initMap;
	</script>

<div class="sidebar-container">
    <div class="sidebar-content">
        <div class="sidebar-header">
            <h1 class="sidebar-title">FEED</h1>
        </div>
        <div class="divider"></div>
        <div class="search">
            <span class="">
                <form id="search" class="d-flex input-group" role="search">
                    <input class="form-control transparent-input shadow-none" type="search" placeholder="Search"
                        aria-label="Search">
                    <button class="btn btn-search" type="submit"><span class="bi-search icon-blue"></span></button>
                </form>
            </span>
        </div>
        <div class="sidebar-item">
            <form action="/feed">
                <button class="btn btn-primary" type="submit">Near Me</button>
            </form>
            <form action="/feed">
                <button class="btn btn-primary" type="submit">Friends</button>
            </form>
            <form action="/feed">
                <button class="btn btn-primary" type="submit">Venues</button>
            </form>
            <form action="/feed">
                <button class="btn btn-primary" type="submit">Events</button>
            </form>
            <div id="map"></div>
                <script
                  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFoKhJXjpdutYp5APDID5ZVG4fi--9PDg&callback=initMap&v=weekly"
                  defer
                ></script>
            <div class="post">
                <form action="/create" method="get">
                    <div class="get_create">
                        <button class="btn btn-post" type="submit">Create Post</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>